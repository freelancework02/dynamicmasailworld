<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">

  <title><%= meta && meta.title ? meta.title : 'مسائل ورلڈ — مضمون' %></title>

  <!-- SEO / Social -->
  <% if (meta) { %>
    <meta name="description" content="<%= meta.description %>">
    <meta name="author" content="<%= meta.author %>">
    <link rel="canonical" href="<%= meta.url %>">

    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="<%= meta.title %>">
    <meta property="og:description" content="<%= meta.description %>">
    <meta property="og:url" content="<%= meta.url %>">
    <meta property="og:image" content="<%= meta.image %>">
    <% if (meta.publishedTime) { %><meta property="article:published_time" content="<%= meta.publishedTime %>"><% } %>
    <% if (meta.modifiedTime)  { %><meta property="article:modified_time"  content="<%= meta.modifiedTime  %>"><% } %>

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= meta.title %>">
    <meta name="twitter:description" content="<%= meta.description %>">
    <meta name="twitter:image" content="<%= meta.image %>">
  <% } %>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <style>
    @font-face {
      font-family: 'NaatFont';
      src: url('https://res.cloudinary.com/awescreative/raw/upload/v1749150996/Awes/naatfont.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    body {
      font-family: 'NaatFont', serif;
      font-size: 80%;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding-bottom: 70px; /* bottom nav space */
      padding-top: 56px;    /* mobile header space */
      background-color: #eff6e0;
    }
    @media (min-width: 768px) { body { padding-top: 0; } }

    .mw-toast {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: #01161e;
      color: #eff6e0;
      padding: 8px 12px;
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(1,22,30,.35);
      z-index: 9999;
      font-size: 14px;
      opacity: 0;
      transition: opacity .2s ease;
    }

    .circular-logo { border-radius: 50%; }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'rich_black': { DEFAULT:'#01161e' },
            'midnight_green': { DEFAULT:'#124559' },
            'air_force_blue': { DEFAULT:'#598392' },
            'ash_gray': { DEFAULT:'#aec3b0' },
            'beige': { DEFAULT:'#eff6e0' }
          }
        }
      }
    }
  </script>
</head>
<body>

  <!-- Loader -->
  <div id="loader" class="fixed inset-0 flex items-center justify-center bg-beige z-50">
    <span class="text-3xl md:text-5xl font-bold text-midnight_green animate-pulse">
      صَلَّى اللّٰهُ عَلَيْهِ وَسَلَّمْ
    </span>
  </div>

  <!-- Mobile-only header bar -->
  <div class="fixed top-0 left-0 right-0 md:hidden bg-rich_black text-white flex justify-between items-center py-2 px-4 z-50">
    <a href="/Pages/Question.html" class="text-sm text-beige hover:text-ash_gray transition">سوال پوچھیں</a>
    <div class="flex items-center space-x-4 space-x-reverse">
      <!-- Share icons (mobile) -->
      <a id="sm-fb-mobile" href="#" class="hover:text-beige transition text-base" aria-label="Share on Facebook">
        <i class="bi bi-facebook"></i>
      </a>
      <a id="sm-wa-mobile" href="#" class="hover:text-beige transition text-base" aria-label="Share on WhatsApp">
        <i class="bi bi-whatsapp"></i>
      </a>
      <a id="sm-x-mobile" href="#" class="hover:text-beige transition text-base" aria-label="Share on X">
        <i class="bi bi-twitter-x"></i>
      </a>
      <!-- Generic share -->
      <a id="sm-share-mobile" href="#" class="hover:text-beige transition text-base" aria-label="Share">
        <i class="bi bi-share-fill"></i>
      </a>
    </div>
  </div>

  <!-- Header -->
  <header id="qs-header" class="bg-beige/90 backdrop-blur-md shadow-lg sticky top-0 z-50 rounded-b-xl hidden md:block">
    <div class="bg-rich_black text-air_force_blue-700 py-2">
      <div class="container mx-auto px-4 sm:px-6 flex justify-between items-center space-x-reverse text-lg">
        <a href="/Pages/Question.html" class="nav-link text-beige hover:text-ash_gray transition">سوال پوچھیں</a>
        <div class="flex items-center space-x-4 space-x-reverse">
          <!-- Share icons (desktop header) -->
          <a id="sm-fb-desktop" href="#" class="hover:text-beige transition" aria-label="Share on Facebook">
            <i class="bi bi-facebook"></i>
          </a>
          <a id="sm-wa-desktop" href="#" class="hover:text-beige transition" aria-label="Share on WhatsApp">
            <i class="bi bi-whatsapp"></i>
          </a>
          <a id="sm-x-desktop" href="#" class="hover:text-beige transition" aria-label="Share on X">
            <i class="bi bi-twitter-x"></i>
          </a>
          <a id="sm-share-desktop" href="#" class="hover:text-beige transition" aria-label="Share">
            <i class="bi bi-share-fill"></i>
          </a>
        </div>
      </div>
    </div>

    <nav class="container mx-auto px-4 sm:px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="text-3xl font-bold text-midnight_green">
          <a href="https://masailworld.com/" class="flex items-center space-x-reverse space-x-2">
            <img src="https://alqalamarts.com/mw/masailworld.png" alt="Masail World Logo" class="h-10 w-10 circular-logo">
            <span class="text-3xl font-bold text-midnight_green">مسائل ورلڈ</span>
            <span class="text-xl font-normal block">دار الافتاء اہل سنت</span>
          </a>
        </div>
        <div class="hidden md:flex items-center space-x-reverse space-x-8">
          <a href="/" class="text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">صفحہ اول</a>
          <a href="/fatwa" class="text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">فتاویٰ</a>
          <a href="/about" class="text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">تعارف</a>
          <a href="/article" class="text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">مضامین</a>
          <a href="/Categoryfatawa" class="text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">موضوعات</a>
          <a href="/book" class="text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">اسلامی کتب</a>
          <a href="/question" class="text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">سوال پوچھیں</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Article Detail -->
  <main class="pt-20 md:pt-8">
    <div class="container mx-auto px-6 max-w-4xl py-12">
      <a href="https://masailworld.com/Pages/articles.html" class="inline-block text-midnight_green hover:underline mb-6">&larr; واپس تمام مضامین پر</a>

      <article id="article-root" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-[rgba(174,195,176,0.35)]">
        <!-- Article header -->
        <header class="mb-6">
          <h1 id="article-title" class="text-3xl md:text-4xl font-bold text-midnight_green leading-tight">
            <%= (article && (article.Title || article.title)) || 'بدون عنوان' %>
          </h1>

          <div class="mt-3 flex items-center justify-between space-x-reverse gap-4">
            <div class="text-sm text-air_force_blue-700">
              <span id="article-author" class="block">
                مصنف: <%= (meta && meta.author) || (article && article.writer) || 'ادارہ مسائل ورلڈ' %>
              </span>
              <time id="article-date" class="block text-xs text-gray-500 mt-1">
                تاریخ: <%= (meta && meta.publishedDateLabel) || 'نامعلوم' %>
              </time>
            </div>

            <!-- Views + Share icons (replacing like) -->
            <div class="flex items-center space-x-4 space-x-reverse text-air_force_blue text-lg">
              <div class="flex items-center">
                <i class="bi bi-eye-fill ml-2"></i>
                <span id="viewCount" class="font-sans"><%= Number(article?.Views || article?.views || 0) %></span>
              </div>

              <!-- Article-header share shortcuts -->
              <a id="ah-fb" href="#" class="hover:text-midnight_green transition-colors" aria-label="Facebook">
                <i class="bi bi-facebook"></i>
              </a>
              <a id="ah-wa" href="#" class="hover:text-midnight_green transition-colors" aria-label="WhatsApp">
                <i class="bi bi-whatsapp"></i>
              </a>
              <a id="ah-x" href="#" class="hover:text-midnight_green transition-colors" aria-label="X">
                <i class="bi bi-twitter-x"></i>
              </a>
              <button type="button" id="ah-share" class="flex items-center hover:text-midnight_green transition-colors" aria-label="اس صفحہ کو شیئر کریں">
                <i class="bi bi-share-fill"></i>
              </button>
            </div>
          </div>
        </header>

        <!-- Main article image (proxied through your server) -->
        <% const _id = (article && (article.id || article.ID || article.articleId)); %>
        <img
          src="/article/<%= encodeURIComponent(_id) %>/image"
          alt="<%= (article && (article.Title || article.title)) || 'تصویر' %>"
          class="w-full h-auto object-cover rounded-xl shadow-md mb-8"
          onerror="this.style.display='none'">

        <!-- Article body -->
        <div id="article-body" class="prose max-w-none mt-6 text-lg leading-relaxed text-gray-800 prose-p:mb-4 prose-img:rounded-xl">
          <% if (article && (article.ArticleText || article.seo)) { %>
            <%- (article.ArticleText || article.seo) %>
          <% } else { %>
            <p class="text-gray-500 italic">مضمون کا متن دستیاب نہیں ہے۔</p>
          <% } %>
        </div>
      </article>

      <!-- Related Articles -->
      <div class="mt-16">
        <h2 class="text-3xl md:text-4xl font-bold text-center text-midnight_green mb-12">متعلقہ مضامین</h2>
        <div id="related-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <% if (Array.isArray(related) && related.length) { %>
            <% related.forEach(function(a){ const rid = a.id || a.ID || a.articleId; const rtitle = a.Title || a.title || 'بدون عنوان'; %>
              <a class="block p-4 bg-white rounded-xl shadow hover:shadow-md border" href="/article/<%= encodeURIComponent(rid) %>">
                <img src="/article/<%= encodeURIComponent(rid) %>/image" alt="<%= rtitle %>" class="w-full h-56 object-cover mb-4" onerror="this.style.display='none'">
                <h3 class="text-xl font-semibold text-midnight_green"><%= rtitle %></h3>
                <p class="mt-2 text-sm text-gray-600">مکمل مضمون پڑھیں &larr;</p>
              </a>
            <% }) %>
          <% } else { %>
            <p class="text-gray-600 text-center">مزید مضامین دستیاب نہیں۔</p>
          <% } %>
        </div>
      </div>

    </div>
  </main>

  <!-- Bottom Nav (mobile) -->
  <nav class="fixed bottom-0 left-0 right-0 md:hidden bg-beige shadow-top-lg border-t border-ash_gray/50 z-50 rounded-t-xl">
    <ul class="flex justify-around items-center h-16">
      <li>
        <a href="/" class="nav-link flex flex-col items-center justify-center text-midnight_green hover:text-midnight_green-600 transition transform hover:scale-110 active:scale-100">
          <i class="bi bi-house-door-fill text-xl"></i>
          <span class="text-sm">صفحہ اول</span>
        </a>
      </li>
      <li>
        <a href="https://masailworld.com/Pages/fatawa.html" class="flex flex-col items-center justify-center text-midnight_green hover:text-midnight_green-600 transition transform hover:scale-110 active:scale-100">
          <i class="bi bi-file-text-fill text-xl"></i>
          <span class="text-sm">فتاویٰ</span>
        </a>
      </li>
      <li>
        <a href="https://masailworld.com/Pages/book.html" class="flex flex-col items-center justify-center text-midnight_green hover:text-midnight_green-600 transition transform hover:scale-110 active:scale-100">
          <i class="bi bi-book-fill text-xl"></i>
          <span class="text-sm">اسلامی کتب</span>
        </a>
      </li>
      <li>
        <a href="/Pages/Question.html" class="nav-link flex flex-col items-center justify-center text-midnight_green hover:text-midnight_green-600 transition transform hover:scale-110 active:scale-100">
          <i class="bi bi-chat-dots-fill text-xl"></i>
          <span class="text-sm">سوال پوچھیں</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Footer -->
  <footer id="qs-footer" class="bg-rich_black text-beige pt-16 rounded-t-2xl">
    <div class="container mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-10">
        <div class="col-span-1 md:col-span-2">
          <h3 class="text-3xl font-bold mb-4">مسائل ورلڈ</h3>
          <p class="text-air_force_blue-700 text-lg leading-relaxed">
            ایک آن لائن پلیٹ فارم جو قرآن و سنت کی روشنی میں آپ کے مسائل کا حل پیش کرتا ہے۔ ہمارا مقصد مستند علمی تحقیق اور اہلسنت والجماعت کے مطابق رہنمائی کو عام کرنا ہے۔
          </p>
          <div class="flex space-x-5 space-x-reverse text-3xl mt-6">
            <a id="sm-fb-footer" href="#" class="text-air_force_blue-700 hover:text-beige transition" aria-label="Share on Facebook">
              <i class="bi bi-facebook"></i>
            </a>
            <a id="sm-wa-footer" href="#" class="text-air_force_blue-700 hover:text-beige transition" aria-label="Share on WhatsApp">
              <i class="bi bi-whatsapp"></i>
            </a>
            <a id="sm-x-footer" href="#" class="hover:text-beige transition" aria-label="Share on X">
              <i class="bi bi-twitter-x"></i>
            </a>
            <a id="sm-share-footer" href="#" class="hover:text-beige transition" aria-label="Share">
              <i class="bi bi-share-fill"></i>
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">فوری لنکس</h3>
          <ul class="space-y-3 text-lg">
            <li><a href="https://masailworld.com/Pages/fatawa.html" class="text-air_force_blue-700 hover:text-beige transition">فتاویٰ</a></li>
            <li><a href="https://masailworld.com/Pages/articles.html" class="text-air_force_blue-700 hover:text-beige transition">مضامین</a></li>
            <li><a href="/Pages/Question.html" class="nav-link text-air_force_blue-700 hover:text-beige transition">سوال پوچھیں</a></li>
            <li><a href="https://masailworld.com#about" class="nav-link text-air_force-blue-700 hover:text-beige transition">ہمارے بارے میں</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">ہم سے رابطہ کریں</h3>
          <ul class="space-y-3 text-lg text-air_force_blue-700">
            <li><i class="bi bi-envelope ml-2"></i>azharalimi95@gmail.com</li>
            <li><i class="bi bi-geo-alt ml-2"></i>Jamia Quadria Alimia Taloja Phase 1 New Mumbai</li>
          </ul>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">ہمارے بارے میں</h3>
          <p class="text-air_force_blue-700 text-lg leading-relaxed">مسائل ورلڈ ایک آن لائن پلیٹ فارم ہے جو اہل سنت والجماعت کے مطابق شرعی رہنمائی فراہم کرتا ہے۔</p>
          <a href="https://alqalamarts.com/" target="_blank" class="text-air_force_blue-700 hover:text-beige transition block mt-2 text-sm font-sans">
            <button id="install-app-button" class="bg-air_force_blue-600 text-white font-bold py-2 px-6 rounded-full hover:bg-air_force_blue-400 transition text-sm sm:text-md shadow-md mt-4">
              <i class="bi bi-plus-circle ml-2"></i> ایپ انسٹال کریں
            </button>
          </a>
        </div>
      </div>
      <div class="mt-12 border-t border-midnight_green-400 pt-8 pb-8 text-center text-air_force_blue">
        <p class="text-lg">© 2025 AlQalamArts.com. All rights reserved. | © ২০২৫ مسائل ورلڈ۔ تمام حقوق محفوظ ہیں۔</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    "use strict";

    /* ----------------------------
       SMOOTH SCROLL (optional)
    -----------------------------*/
    document.querySelectorAll('a[href^="#"]').forEach(a => {
      a.addEventListener('click', function (e) {
        // optional smooth behaviour (commented out)
        // e.preventDefault();
        // document.querySelector(this.getAttribute('href'))?.scrollIntoView({ behavior: 'smooth' });
      });
    });

    /* ----------------------------
       URL / DOM HOOKS
    -----------------------------*/
    <% const _id_for_js = (article && (article.id || article.ID || article.articleId)); %>
    const articleId = <%- JSON.stringify(_id_for_js || null) %>;
    const articleContainer = document.querySelector("article#article-root");

    /* ----------------------------
       LOADER HELPERS
    -----------------------------*/
    function showLoader(){ const l=document.getElementById('loader'); if(l) l.style.display='flex'; }
    function hideLoader(){ const l=document.getElementById('loader'); if(l) l.style.display='none'; }

    /* ----------------------------
       TOAST
    -----------------------------*/
    function showToast(message) {
      const t = document.createElement('div');
      t.className = 'mw-toast';
      t.dir = 'rtl';
      t.textContent = message;
      document.body.appendChild(t);
      requestAnimationFrame(() => t.style.opacity = '1');
      setTimeout(() => {
        t.style.opacity = '0';
        setTimeout(() => t.remove(), 250);
      }, 1400);
    }

    /* ----------------------------
       SHARE HELPERS
    -----------------------------*/
    function popupCenter(url, title) {
      const w=640,h=560;
      const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;
      const dualScreenTop  = window.screenTop  !== undefined ? window.screenTop  : screen.top;
      const width  = window.innerWidth || document.documentElement.clientWidth || screen.width;
      const height = window.innerHeight || document.documentElement.clientHeight || screen.height;
      const left = ((width / 2) - (w / 2)) + dualScreenLeft;
      const top  = ((height / 2) - (h / 2)) + dualScreenTop;
      const features = `scrollbars=yes,width=${w},height=${h},top=${top},left=${left}`;
      window.open(url, title, features);
    }

    function buildShareLinks(url, text) {
      const u = encodeURIComponent(url);
      const t = encodeURIComponent(text || document.title || "مسائل ورلڈ");
      return {
        facebook: `https://www.facebook.com/sharer/sharer.php?u=${u}`,
        x:        `https://twitter.com/intent/tweet?url=${u}&text=${t}`,
        whatsapp: `https://wa.me/?text=${t}%20${u}`,
        telegram: `https://t.me/share/url?url=${u}&text=${t}`,
        linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${u}`
      };
    }

    async function copyCurrentUrl() {
      const currentUrl = window.location.href;
      try {
        await navigator.clipboard.writeText(currentUrl);
        alert("🔗 لنک کاپی ہوگیا ہے!");
      } catch (err) {
        console.error("Clipboard copy failed:", err);
        alert("⚠️ لنک کاپی کرنے میں مسئلہ آیا۔");
      }
    }

    async function openShare() {
      const url = window.location.href;
      const title = document.title || "مسائل ورلڈ";
      const text = "اس صفحہ کا لنک ملاحظہ کریں:";

      if (navigator.share) {
        try {
          await navigator.share({ title, text, url });
          return;
        } catch (e) {
          if (e && e.name === "AbortError") return;
        }
      }

      const links = buildShareLinks(url, title);
      const choice = prompt("شیئر کریں: facebook, x, whatsapp, telegram, linkedin, copy", "facebook");
      if (!choice) return;
      const key = choice.toLowerCase().trim();
      if (key === "copy") return copyCurrentUrl();
      if (links[key]) {
        popupCenter(links[key], "Share");
      } else {
        alert("ناموزوں انتخاب۔ درج ذیل میں سے ایک لکھیں: facebook, x, whatsapp, telegram, linkedin, copy");
      }
    }

    function wireSocialShareAnchors() {
      const url = window.location.href;
      const links = buildShareLinks(url, document.title);

      const map = {
        // header mobile
        "sm-fb-mobile": links.facebook,
        "sm-wa-mobile": links.whatsapp,
        "sm-x-mobile":  links.x,
        "sm-share-mobile": url,

        // header desktop
        "sm-fb-desktop": links.facebook,
        "sm-wa-desktop": links.whatsapp,
        "sm-x-desktop":  links.x,
        "sm-share-desktop": url,

        // footer
        "sm-fb-footer": links.facebook,
        "sm-wa-footer": links.whatsapp,
        "sm-x-footer":  links.x,
        "sm-share-footer": url,

        // article header inline
        "ah-fb": links.facebook,
        "ah-wa": links.whatsapp,
        "ah-x":  links.x
      };

      Object.keys(map).forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        if (el.tagName === 'A') el.setAttribute('href', map[id]);
        el.addEventListener("click", function (e) {
          e.preventDefault();
          if (id.includes('share')) {
            openShare();
            return;
          }
          popupCenter(map[id], "Share");
        });
      });

      const ahShareBtn = document.getElementById('ah-share');
      if (ahShareBtn) ahShareBtn.addEventListener('click', openShare);
    }

    /* ----------------------------
       Views logic
    -----------------------------*/
    function sendViewOnceVisible(id, viewCountEl) {
      if (!id) return;
      const target = document.getElementById('article-root');
      if (!target) return;

      let counted = false, timer = null;

      const fire = async () => {
        if (counted) return;
        counted = true;
        try {
          const res = await fetch(`https://masailworld.onrender.com/api/article/${encodeURIComponent(id)}/view`, {
            method: 'POST',
            credentials: 'include'
          });
          if (res.ok) {
            const data = await res.json().catch(() => ({}));
            if (data && data.counted && viewCountEl) {
              const cur = parseInt(viewCountEl.textContent || '0', 10) || 0;
              viewCountEl.textContent = String(cur + 1);
            }
          }
        } catch (e) {}
      };

      if (!('IntersectionObserver' in window)) {
        setTimeout(fire, 3000);
        return;
      }

      const io = new IntersectionObserver(entries => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            timer = setTimeout(fire, 3000);
          } else if (timer) {
            clearTimeout(timer);
          }
        });
      }, { threshold: 0.5 });

      io.observe(target);
    }

    /* ----------------------------
       INIT
    -----------------------------*/
    document.addEventListener("DOMContentLoaded", () => {
      wireSocialShareAnchors();

      // Hide loader after small delay
      window.addEventListener('load', () => {
        setTimeout(() => { hideLoader(); }, 250);
      });

      // Count a view after visible ~3s
      const viewCountEl = document.getElementById('viewCount');
      sendViewOnceVisible(articleId, viewCountEl);
    });
  </script>

  <!-- (Optional) keep your external script reference if you still use it -->
  <!-- <script src="/js/article_details.js"></script> -->
</body>
</html>
 