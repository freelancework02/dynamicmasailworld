<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">

  <title><%= article.Title ? article.Title + ' — مسائل ورلڈ' : 'مسائل ورلڈ' %></title>

  <% 
    const safe = str => (str ? String(str) : '');
    const excerpt = (s, n=160) => {
      if (!s) return '';
      const t = s.replace(/(<[^>]+>|\s+)/g, ' ').trim();
      return t.length <= n ? t : (t.slice(0, n-1).trim() + '…');
    };
    const desc = article.seoDescription || article.summary || excerpt(article.ArticleText || '', 180);
    const img = article.imageUrl || (`${API_BASE}/${article.id}/image`);
    const pageUrl = requestUrl;
  %>

  <meta name="description" content="<%= desc %>">
  <link rel="canonical" href="<%= pageUrl %>">
  <% if (img) { %>
    <meta property="og:image" content="<%= img %>">
    <meta property="og:image:alt" content="<%= article.Title %>">
  <% } %>
  <meta property="og:type" content="article">
  <meta property="og:title" content="<%= article.Title %>">
  <meta property="og:description" content="<%= desc %>">
  <meta property="og:url" content="<%= pageUrl %>">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= article.Title %>">
  <meta name="twitter:description" content="<%= desc %>">
  <% if (img) { %><meta name="twitter:image" content="<%= img %>"><% } %>

  <!-- Schema.org JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "<%= article.Title %>",
    "image": ["<%= img %>"],
    "datePublished": "<%= article.createdAt ? new Date(article.createdAt).toISOString() : '' %>",
    "author": { "@type": "Organization", "name": "<%= article.writer || 'ادارہ مسائل ورلڈ' %>" },
    "publisher": {
      "@type": "Organization",
      "name": "مسائل ورلڈ",
      "logo": { "@type": "ImageObject", "url": "https://alqalamarts.com/mw/masailworld.png" }
    },
    "description": "<%= desc %>"
  }
  </script>

  <!-- Tailwind + Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <style>
    @font-face {
      font-family: 'NaatFont';
      src: url('https://res.cloudinary.com/awescreative/raw/upload/v1749150996/Awes/naatfont.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    body {
      font-family: 'NaatFont', serif;
      font-size: 80%;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding-bottom: 70px;
      padding-top: 56px;
      background-color: #eff6e0;
    }
    @media (min-width: 768px) { body { padding-top: 0; } }

    .hero-section {
      background-image: linear-gradient(rgba(1,22,30,.7), rgba(1,22,30,.7)), url('https://img.freepik.com/free-photo/close-up-islamic-new-year-concept-with-misbaha_23-2148611691.jpg');
      background-size: cover;
      background-position: center;
    }

    .like-btn { transition: transform .12s ease, box-shadow .12s ease; will-change: transform; }
    .like-btn:active { transform: scale(.98); }
    .like-btn:focus { outline: 3px solid rgba(89,131,146,0.22); outline-offset: 2px; }

    .mobile-like-wrap { display: none; }
    @media (max-width: 767px) {
      .mobile-like-wrap { display:block; position:fixed; left:12px; right:12px; bottom:82px; z-index:60; }
    }

    .mw-toast {
      position: fixed; bottom: 16px; right: 16px;
      background: #01161e; color: #eff6e0;
      padding: 8px 12px; border-radius: 10px;
      box-shadow: 0 6px 20px rgba(1,22,30,.35);
      z-index: 9999; font-size: 14px;
      opacity: 0; transition: opacity .2s ease;
    }
  </style>

  <script>
    tailwind.config = {
      theme: { extend: {
        colors: {
          'rich_black': '#01161e',
          'midnight_green': '#124559',
          'air_force_blue': '#598392',
          'ash_gray': '#aec3b0',
          'beige': '#eff6e0'
        }
      }}
    }
  </script>
</head>

<body>

  <!-- Loader -->
  <div id="loader" class="fixed inset-0 flex items-center justify-center bg-beige z-50">
    <span class="text-3xl md:text-5xl font-bold text-midnight_green animate-pulse">
      صَلَّى اللّٰهُ عَلَيْهِ وَسَلَّمْ
    </span>
  </div>

  <!-- Mobile Header -->
  <div class="fixed top-0 left-0 right-0 md:hidden bg-rich_black text-white flex justify-between items-center py-2 px-4 z-50">
    <a href="/Question" class=" text-sm text-beige hover:text-ash_gray transition">سوال پوچھیں</a>
    <div class="flex items-center space-x-4 space-x-reverse">
      <a id="sm-fb-mobile" href="#" class="hover:text-beige transition text-base"><i class="bi bi-facebook"></i></a>
      <a id="sm-x-mobile" href="#" class="hover:text-beige transition text-base"><i class="bi bi-twitter-x"></i></a>
      <a href="http://youtube.com/c/AzharAlimi" class="hover:text-beige transition text-base"><i class="bi bi-youtube"></i></a>
    </div>
  </div>

  <!-- Desktop Header -->
  <header id="qs-header" class="bg-beige/90 backdrop-blur-md shadow-lg sticky top-0 z-50 rounded-b-xl hidden md:block">
    <div class="bg-rich_black text-air_force_blue-700 py-2">
      <div class="container mx-auto px-4 sm:px-6 flex justify-between items-center">
        <a href="/Question" class="nav-link text-beige hover:text-ash_gray transition">سوال پوچھیں</a>
        <div class="flex items-center space-x-4 space-x-reverse">
          <a id="sm-fb-desktop" href="#" class="hover:text-beige transition"><i class="bi bi-facebook"></i></a>
          <a id="sm-x-desktop" href="#" class="hover:text-beige transition"><i class="bi bi-twitter-x"></i></a>
          <a href="http://youtube.com/c/AzharAlimi" class="hover:text-beige transition"><i class="bi bi-youtube"></i></a>
        </div>
      </div>
    </div>
    <nav class="container mx-auto px-4 sm:px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="text-3xl font-bold text-midnight_green flex items-center space-x-reverse space-x-2">
          <img src="https://alqalamarts.com/mw/masailworld.png" alt="Masail World Logo" class="h-10 w-10 rounded-full">
          <span>مسائل ورلڈ</span><span class="text-xl font-normal block">دار الافتاء اہل سنت</span>
        </div>
        <div class="hidden md:flex items-center space-x-reverse space-x-8">
          <a href="/" class="text-midnight_green hover:text-midnight_green-600 font-semibold text-lg">صفحہ اول</a>
          <a href="/Pages/fatawa.html" class="text-midnight_green hover:text-midnight_green-600 font-semibold text-lg">فتاویٰ</a>
          <a href="/#about" class="text-midnight_green hover:text-midnight_green-600 font-semibold text-lg">تعارف</a>
          <a href="/Pages/articles.html" class="text-midnight_green hover:text-midnight_green-600 font-semibold text-lg">مضامین</a>
          <a href="/Pages/Categoryfatawa.html" class="text-midnight_green hover:text-midnight_green-600 font-semibold text-lg">موضوعات</a>
          <a href="/Pages/book.html" class="text-midnight_green hover:text-midnight_green-600 font-semibold text-lg">اسلامی کتب</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Article Section -->
  <main class="pt-20 md:pt-8">
    <div class="container mx-auto px-6 max-w-4xl py-12">
      <a href="/Pages/articles.html" class="inline-block text-midnight_green hover:underline mb-6">&larr; واپس تمام مضامین پر</a>

      <article id="article-root" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-[rgba(174,195,176,0.35)]">
        <header class="mb-6">
          <h1 id="article-title" class="text-3xl md:text-4xl font-bold text-midnight_green leading-tight"><%= article.Title %></h1>

          <div class="mt-3 flex items-center justify-between space-x-reverse gap-4">
            <div class="text-sm text-air_force_blue-700">
              <span id="article-author" class="block">مصنف: <%= article.writer || 'ادارہ مسائل ورلڈ' %></span>
              <time id="article-date" class="block text-xs text-gray-500 mt-1">
                تاریخ: <%= article.createdAt ? new Date(article.createdAt).toLocaleDateString('ur-PK') : 'نامعلوم' %>
              </time>
            </div>

            <!-- Desktop like button -->
            <div class="hidden sm:flex items-center space-x-3 space-x-reverse">
              <button id="like-btn" type="button"
                class="like-btn inline-flex items-center gap-2 px-4 py-2 rounded-full border shadow-sm text-base font-medium
                       bg-beige text-midnight_green border-air_force_blue-200 hover:shadow-md"
                aria-pressed="false" aria-label="پسند کریں">
                <i id="like-icon" class="bi bi-heart text-xl"></i>
                <span id="like-text">پسند کریں</span>
                <span id="like-count" class="ml-2 text-sm text-gray-600">0</span>
              </button>
            </div>
          </div>
        </header>

        <!-- Mobile like bar -->
        <div class="mobile-like-wrap sm:hidden">
          <button id="mobile-like-btn"
            class="w-full flex items-center justify-center gap-3 px-5 py-3 rounded-xl shadow-lg text-lg font-semibold like-btn bg-midnight_green text-white"
            aria-pressed="false">
            <i id="mobile-like-icon" class="bi bi-heart text-2xl"></i>
            <span id="mobile-like-text">پسند کریں</span>
            <span id="mobile-like-count" class="text-sm opacity-90">0</span>
          </button>
        </div>

        <!-- Article body -->
        <% if (img) { %>
          <img src="<%= img %>" alt="<%= article.Title %>" class="w-full h-auto object-cover rounded-xl shadow-md mb-8">
        <% } %>
        <div id="article-body" class="prose prose-urdu max-w-none mt-6 text-lg leading-relaxed text-gray-800">
          <%- article.ArticleText %>
        </div>
      </article>

      <!-- Related articles -->
      <div class="mt-16">
        <h2 class="text-3xl md:text-4xl font-bold text-center text-midnight_green mb-12">متعلقہ مضامین</h2>
        <div id="related-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <% if (related && related.length) { %>
            <% related.forEach(r => { %>
              <a class="block p-4 bg-white rounded-xl shadow hover:shadow-md border" href="/article/<%= r.id %>">
                <h3 class="text-xl font-semibold text-midnight_green"><%= r.Title %></h3>
                <p class="mt-2 text-sm text-gray-600"><%= r.summary || excerpt(r.ArticleText, 120) %></p>
              </a>
            <% }) %>
          <% } else { %>
            <p class="text-gray-600 text-center">متعلقہ مضامین دستیاب نہیں۔</p>
          <% } %>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer id="qs-footer" class="bg-rich_black text-beige pt-16 rounded-t-2xl">
    <div class="container mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-10">
        <div class="col-span-1 md:col-span-2">
          <h3 class="text-3xl font-bold mb-4">مسائل ورلڈ</h3>
          <p class="text-air_force_blue-700 text-lg leading-relaxed">ایک آن لائن پلیٹ فارم جو قرآن و سنت کی روشنی میں آپ کے مسائل کا حل پیش کرتا ہے۔</p>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">فوری لنکس</h3>
          <ul class="space-y-3 text-lg">
            <li><a href="/Pages/fatawa.html" class="text-air_force_blue-700 hover:text-beige transition">فتاویٰ</a></li>
            <li><a href="/Pages/articles.html" class="text-air_force_blue-700 hover:text-beige transition">مضامین</a></li>
            <li><a href="/Question" class="text-air_force_blue-700 hover:text-beige transition">سوال پوچھیں</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">ہم سے رابطہ کریں</h3>
          <ul class="space-y-3 text-lg text-air_force_blue-700">
            <li><i class="bi bi-envelope ml-2"></i>azharalimi95@gmail.com</li>
            <li><i class="bi bi-geo-alt ml-2"></i>Jamia Quadria Alimia Taloja Phase 1 New Mumbai</li>
          </ul>
        </div>
      </div>
      <div class="mt-12 border-t border-midnight_green-400 pt-8 pb-8 text-center text-air_force_blue">
        <p class="text-lg">© 2025 AlQalamArts.com | © 2025 مسائل ورلڈ۔ تمام حقوق محفوظ ہیں۔</p>
      </div>
    </div>
  </footer>

  <!-- Like button JS -->
 <script>
    (function () {
      // Hide loader after small delay
      window.addEventListener('load', () => {
        setTimeout(() => {
          const loader = document.getElementById('loader');
          if (loader) loader.style.display = 'none';
        }, 250);
      });

      // Elements
      const likeBtn = document.getElementById('like-btn');
      const likeIcon = document.getElementById('like-icon');
      const likeText = document.getElementById('like-text');
      const likeCount = document.getElementById('like-count');

      const mobileBtn = document.getElementById('mobile-like-btn');
      const mobileIcon = document.getElementById('mobile-like-icon');
      const mobileText = document.getElementById('mobile-like-text');
      const mobileCount = document.getElementById('mobile-like-count');

      // Key for localStorage (per-article basis). If you have article id, include it.
      const ARTICLE_KEY = 'mw_article_like_1'; // change suffix to article id if available

      function readState() {
        try {
          return JSON.parse(localStorage.getItem(ARTICLE_KEY)) || { liked: false, count: 0 };
        } catch (e) {
          return { liked: false, count: 0 };
        }
      }
      function writeState(state) {
        try {
          localStorage.setItem(ARTICLE_KEY, JSON.stringify(state));
        } catch (e) {}
      }

      function render(state) {
        const { liked, count } = state;

        // Desktop
        if (likeBtn) {
          likeBtn.setAttribute('aria-pressed', String(Boolean(liked)));
          likeText.textContent = liked ? 'پسند شدہ' : 'پسند کریں';
          likeCount.textContent = String(count);
          likeIcon.className = liked ? 'bi bi-heart-fill text-red-400' : 'bi bi-heart text-xl';
          // visual differences
          likeBtn.classList.toggle('bg-midnight_green', liked);
          likeBtn.classList.toggle('text-white', liked);
          likeBtn.classList.toggle('bg-beige', !liked);
          likeBtn.classList.toggle('text-midnight_green', !liked);
        }

        // Mobile
        if (mobileBtn) {
          mobileBtn.setAttribute('aria-pressed', String(Boolean(liked)));
          mobileText.textContent = liked ? 'پسند شدہ' : 'پسند کریں';
          mobileCount.textContent = String(count);
          mobileIcon.className = liked ? 'bi bi-heart-fill text-white text-2xl' : 'bi bi-heart text-2xl';
          mobileBtn.classList.toggle('bg-midnight_green', liked);
          mobileBtn.classList.toggle('text-white', liked);
          mobileBtn.classList.toggle('bg-midnight_green/90', !liked); // keep contrast when not liked
        }
      }

      function toggleLike() {
        const state = readState();
        const newState = {
          liked: !state.liked,
          count: state.liked ? Math.max(0, state.count - 1) : state.count + 1
        };
        writeState(newState);
        render(newState);
        // You can place a fetch() here to call your API (like /articles/:id/like)
      }

      // init
      const initial = readState();
      // if count is zero set a small sensible default, or you can fetch from server
      if (typeof initial.count !== 'number') initial.count = 0;
      render(initial);

      // attach events
      if (likeBtn) likeBtn.addEventListener('click', toggleLike);
      if (mobileBtn) mobileBtn.addEventListener('click', toggleLike);

      // keyboard accessibility: space/enter
      [likeBtn, mobileBtn].forEach(btn => {
        if (!btn) return;
        btn.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            btn.click();
          }
        });
      });
    })();
  </script>
  <script>
  window.__ARTICLE_ID__ = "<%= article.id %>";
</script>

  <!-- keep your external script if needed (it won't conflict) -->
  <script src="article_details.js"></script>
</body>
</html>