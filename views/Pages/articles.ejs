<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">
  <title>عقیدہ ختمِ نبوت — مضمون | مسائل ورلڈ</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <style>
    @font-face {
      font-family: 'NaatFont';
      src: url('https://res.cloudinary.com/awescreative/raw/upload/v1749150996/Awes/naatfont.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    body {
      font-family: 'NaatFont', serif;
      font-size: 80%;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding-bottom: 70px;
      padding-top: 56px;
      background-color: #eff6e0;
    }
    @media (min-width: 768px) {
      body { padding-top: 0; }
    }
    .hero-section {
      background-image: linear-gradient(rgba(1, 22, 30, 0.7), rgba(1, 22, 30, 0.7)), url('https://img.freepik.com/free-photo/close-up-islamic-new-year-concept-with-misbaha_23-2148611691.jpg');
      background-size: cover;
      background-position: center;
    }
    .page { display: none; }
    .page.active { display: block; }
    #searchDropdown::-webkit-scrollbar,
    #related-fatawa-list::-webkit-scrollbar { width: 8px; }
    #searchDropdown::-webkit-scrollbar-thumb,
    #related-fatawa-list::-webkit-scrollbar-thumb { background-color: #598392; border-radius: 4px; }
    #searchDropdown::-webkit-scrollbar-track,
    #related-fatawa-list::-webkit-scrollbar-track { background: #eff6e0; }
    .circular-logo { border-radius: 50%; }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'rich_black': { DEFAULT: '#01161e' },
            'midnight_green': { DEFAULT: '#124559' },
            'air_force_blue': { DEFAULT: '#598392' },
            'ash_gray': { DEFAULT: '#aec3b0' },
            'beige': { DEFAULT: '#eff6e0' }
          }
        }
      }
    }
  </script>
</head>
<body>

  <!-- Fullscreen loader -->
  <div id="loader" class="fixed inset-0 flex items-center justify-center bg-beige z-50">
    <span class="text-3xl md:text-5xl font-bold text-midnight_green animate-pulse">
      صَلَّى اللّٰهُ عَلَيْهِ وَسَلَّمْ
    </span>
  </div>

  <!-- Mobile-only Social/Ask -->
  <div class="fixed top-0 left-0 right-0 md:hidden bg-rich_black text-white flex justify-between items-center py-2 px-4 z-50">
    <a href="/question" class=" text-sm text-beige hover:text-ash_gray transition">سوال پوچھیں</a>
    <div class="flex items-center space-x-4 space-x-reverse">
      <a href="https://www.facebook.com/share/1PhWgmvP2g/" class="hover:text-beige transition text-base"><i class="bi bi-facebook"></i></a>
      <a href="https://www.facebook.com/share/1PhWgmvP2g/" class="hover:text-beige transition text-base"><i class="bi bi-twitter-x"></i></a>
      <a href="https://youtube.com/c/AzharAlimi" class="hover:text-beige transition text-base"><i class="bi bi-youtube"></i></a>
    </div>
  </div>

  <!-- Header & Navigation (desktop) -->
  <header id="qs-header" class="bg-beige/90 backdrop-blur-md shadow-lg sticky top-0 z-50 rounded-b-xl hidden md:block">
    <div class="bg-rich_black text-air_force_blue-700 py-2">
      <div class="container mx-auto px-4 sm:px-6 flex justify-between items-center space-x-reverse text-lg">
        <a href="/question" class="nav-link text-beige hover:text-ash_gray transition">سوال پوچھیں</a>
        <div class="flex items-center space-x-4 space-x-reverse">
          <a href="https://www.facebook.com/share/1PhWgmvP2g/" class="hover:text-beige transition"><i class="bi bi-facebook"></i></a>
          <a href="https://www.facebook.com/share/1PhWgmvP2g/" class="hover:text-beige transition"><i class="bi bi-twitter-x"></i></a>
          <a href="https://youtube.com/c/AzharAlimi" class="hover:text-beige transition"><i class="bi bi-youtube"></i></a>
        </div>
      </div>
    </div>
    <nav class="container mx-auto px-4 sm:px-6 py-4">
      <div class="flex justify-between items-center">
        <div class="text-3xl font-bold text-midnight_green">
          <a href="https://masailworld.com/" class=" flex items-center space-x-reverse space-x-2">
            <img src="https://alqalamarts.com/mw/masailworld.png" alt="Masail World Logo" class="h-10 w-10 circular-logo">
            <span class="text-3xl font-bold text-midnight_green">مسائل ورلڈ</span>
            <span class="text-xl font-normal block">دار الافتاء اہل سنت</span>
          </a>
        </div>
         <div class="hidden md:flex items-center space-x-reverse space-x-8">
            <a href="/" class=" text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">صفحہ اول</a>
            <a href="/fatwa" class=" text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">فتاویٰ</a>
            <a href="/about" class=" text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">تعارف</a>
            <a href="/articles" class=" text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">مضامین</a>
            <a href="/Categoryfatawa" class=" text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">موضوعات</a>
            <a href="/book" class=" text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">اسلامی کتب</a>
            <a href="/question" class=" text-midnight_green hover:text-midnight_green-600 transition text-lg font-semibold">سوال پوچھیں</a>
         </div>
      </div>
    </nav>
  </header>

  <!-- Content -->
  <main class="pt-20 md:pt-8">
    <div class="container mx-auto px-6 max-w-4xl py-12">
      <a href="https://masailworld.com" class="text-midnight_green font-semibold">&larr; صفحہ اول</a>

      <div class="mt-4">
        <h2 class="text-3xl md:text-4xl font-bold text-center text-midnight_green mb-6">تمام مضامین</h2>

        <!-- Controls row: Search + Listing count -->
        <div class="max-w-3xl mx-auto mb-6 grid grid-cols-1 md:grid-cols-3 gap-3">
          <!-- Search -->
          <div class="md:col-span-2 relative">
            <input id="articleSearchInput" type="text" placeholder="مضمون تلاش کریں…" class="w-full p-4 pr-12 rounded-full border border-black focus:outline-none focus:ring-2 bg-white" />
            <span class="absolute top-1/2 -translate-y-1/2 left-4 text-gray-500"><i class="bi bi-search"></i></span>
          </div>
          <!-- Listing count -->
          <div>
            <select id="limitDropdown" class="w-full p-4 rounded-full border border-black bg-white focus:outline-none focus:ring-2 text-right">
              <option value="50">50 مضامین</option>
              <option value="100">100 مضامین</option>
              <option value="200">200 مضامین</option>
            </select>
          </div>
        </div>

        <!-- Inline loader for refetching -->
        <div id="inlineLoader" class="hidden mx-auto text-center text-sm text-gray-600 mb-4">لوڈ ہو رہا ہے…</div>

        <!-- Articles grid -->
        <div id="articles-list" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
      </div>
    </div>
  </main>

  <!-- Mobile Bottom Nav -->
  <nav class="fixed bottom-0 left-0 right-0 md:hidden bg-beige shadow-top-lg border-t border-ash_gray/50 z-50 rounded-t-xl">
    <ul class="flex justify-around items-center h-16">
      <li>
        <a href="/" class="nav-link flex flex-col items-center justify-center text-midnight_green hover:text-midnight_green-600 transition transform hover:scale-110 active:scale-100">
          <i class="bi bi-house-door-fill text-xl"></i>
          <span class="text-sm">صفحہ اول</span>
        </a>
      </li>
      <li>
        <a href="/fatwa" class=" flex flex-col items-center justify-center text-midnight_green hover:text-midnight_green-600 transition transform hover:scale-110 active:scale-100">
          <i class="bi bi-file-text-fill text-xl"></i>
          <span class="text-sm">فتاویٰ</span>
        </a>
      </li>
      <li>
        <a href="/book" class=" flex flex-col items-center justify-center text-midnight_green hover:text-midnight_green-600 transition transform hover:scale-110 active:scale-100">
          <i class="bi bi-book-fill text-xl"></i>
          <span class="text-sm">اسلامی کتب</span>
        </a>
      </li>
      <li>
        <a href="/question" class="nav-link flex flex-col items-center justify-center text-midnight_green hover:text-midnight_green-600 transition transform hover:scale-110 active:scale-100">
          <i class="bi bi-chat-dots-fill text-xl"></i>
          <span class="text-sm">سوال پوچھیں</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Footer -->
  <footer id="qs-footer" class="bg-rich_black text-beige pt-16 rounded-t-2xl">
    <div class="container mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-10">
        <div class="col-span-1 md:col-span-2">
          <h3 class="text-3xl font-bold mb-4">مسائل ورلڈ</h3>
          <p class="text-air_force_blue-700 text-lg leading-relaxed">ایک آن لائن پلیٹ فارم جو قرآن و سنت کی روشنی میں آپ کے مسائل کا حل پیش کرتا ہے۔ ہمارا مقصد مستند علمی تحقیق اور اہلسنت والجماعت کے مطابق رہنمائی کو عام کرنا ہے۔</p>
          <div class="flex space-x-5 space-x-reverse text-3xl mt-6">
            <a href="https://www.facebook.com/share/1PhWgmvP2g/" class="text-air_force_blue-700 hover:text-beige transition"><i class="bi bi-facebook"></i></a>
            <a href="https://www.facebook.com/share/1PhWgmvP2g/" class="hover:text-beige transition"><i class="bi bi-twitter-x"></i></a>
            <a href="https://youtube.com/c/AzharAlimi" class="text-air_force_blue-700 hover:text-beige transition"><i class="bi bi-youtube"></i></a>
          </div>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">فوری لنکس</h3>
          <ul class="space-y-3 text-lg">
            <li><a href="/fatwa" class="text-air_force_blue-700 hover:text-beige transition">فتاویٰ</a></li>
            <li><a href="/articles" class="text-air_force_blue-700 hover:text-beige transition">مضامین</a></li>
            <li><a href="/question" class="nav-link text-air_force_blue-700 hover:text-beige transition">سوال پوچھیں</a></li>
            <li><a href="/about" class="nav-link text-air_force-blue-700 hover:text-beige transition">ہمارے بارے میں</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">ہم سے رابطہ کریں</h3>
          <ul class="space-y-3 text-lg text-air_force_blue-700">
            <li><i class="bi bi-envelope ml-2"></i>azharalimi95@gmail.com</li>
            <li><i class="bi bi-geo-alt ml-2"></i>Jamia Quadria Alimia Taloja Phase 1 New Mumbai</li>
          </ul>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">ہمارے بارے میں</h3>
          <p class="text-air_force_blue-700 text-lg leading-relaxed">مسائل ورلڈ ایک آن لائن پلیٹ فارم ہے جو اہل سنت والجماعت کے مطابق شرعی رہنمائی فراہم کرتا ہے۔</p>
          <a href="https://alqalamarts.com/" target="_blank" class="text-air_force_blue-700 hover:text-beige transition block mt-2 text-sm font-sans">
            <button id="install-app-button" class="bg-air_force_blue-600 text-white font-bold py-2 px-6 rounded-full hover:bg-air_force_blue-400 transition text-sm sm:text-md shadow-md mt-4">
              <i class="bi bi-plus-circle ml-2"></i> ایپ انسٹال کریں
            </button>
          </a>
        </div>
      </div>
      <div class="mt-12 border-t border-midnight_green-400 pt-8 pb-8 text-center text-air_force_blue">
        <p class="text-lg">© 2025 AlQalamArts.com. All rights reserved. | © 2025 مسائل ورلڈ۔ تمام حقوق محفوظ ہیں۔</p>
      </div>
    </div>
  </footer>

  <!-- Articles: Search + Listing dropdown -->
  <script>
  try { document.designMode = 'off'; } catch (e) {}
  try { document.body.setAttribute('contenteditable','false'); } catch(e){}

  const loader = document.getElementById('loader');
  const inlineLoader = document.getElementById('inlineLoader');
  const listEl = document.getElementById('articles-list');
  const searchInput = document.getElementById('articleSearchInput');
  const limitDropdown = document.getElementById('limitDropdown');

  if (!listEl) console.error('articles-list element not found — script stopped.');

  // --- API bases ---
  // Prefer production API; fall back to same-origin proxy if you host it
  const API_BASE =
    (window.__MW__ && window.__MW__.ARTICLE_API) ||
    'https://dynamicmasailworld.onrender.com/api/article';

  // Use the same host for view increment to avoid mixed content / localhost
  const VIEW_API = API_BASE; // critical fix

  let fullSet = [];
  let limit = 50;
  let isLoading = false;

  function stripHtml(html){
    if (!html) return '';
    const div = document.createElement('div');
    div.innerHTML = html;
    return (div.textContent || div.innerText || '').trim();
  }
  function safeArray(v){ return Array.isArray(v) ? v : []; }
  function pickId(obj) { return obj?.id ?? obj?.ID ?? obj?.Id ?? obj?.articleId ?? obj?.ArticleID; }

  // ---- New: POST-first bump compatible with sendBeacon and simple CORS ----
  function incrementArticleView(id) {
    if (!id) return;
    const url = `${VIEW_API.replace(/\/$/, '')}/${encodeURIComponent(id)}/view`;

    // 1) Try sendBeacon (POST). It survives navigation and is CORS-friendly.
    try {
      if (navigator.sendBeacon) {
        const blob = new Blob(['1'], { type: 'text/plain' }); // simple type => simple request
        if (navigator.sendBeacon(url, blob)) return; // success path
      }
    } catch (_) {}

    // 2) Fallback: fetch POST with keepalive and simple content-type (no preflight)
    try {
      fetch(url, {
        method: 'POST',
        keepalive: true,
        credentials: 'include',
        headers: { 'Content-Type': 'text/plain' },
        body: '1'
      }).catch(() => { /* ignore */ });
    } catch (_) { /* ignore */ }
  }

  function createCard(article){
    const container = document.createElement('div');
    container.className = "cursor-pointer bg-white rounded-2xl shadow-lg overflow-hidden transform hover:-translate-y-2 transition-transform duration-300 border border-[rgba(174,195,176,0.35)]";
    container.tabIndex = 0;

    function goToDetail(){
      const id = pickId(article);
      incrementArticleView(id);
      // Zero-delay is fine; keepalive/beacon will handle navigation
      setTimeout(() => {
        window.location.href = `/article/${encodeURIComponent(id)}`;
      }, 0);
    }

    container.addEventListener('click', goToDetail);
    container.addEventListener('keydown', (e) => { if (e.key === 'Enter') goToDetail(); });

    const img = document.createElement('img');
    img.className = "w-full h-56 object-cover";
    img.alt = article.Title || '';
    const idForImg = pickId(article);
    img.src = `${API_BASE.replace(/\/$/, '')}/${idForImg}/image`;
    img.addEventListener('error', () => {
      img.src = 'data:image/svg+xml;charset=UTF-8,' + encodeURIComponent(
        `<svg xmlns="http://www.w3.org/2000/svg" width="800" height="400">
           <rect width="100%" height="100%" fill="#f3f4f6"/>
           <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20">No image</text>
         </svg>`
      );
    });

    const body = document.createElement('div');
    body.className = "p-6";

    const h3 = document.createElement('h3');
    h3.className = "text-xl md:text-2xl font-bold mb-3 text-rich_black";
    h3.textContent = article.Title || 'بلا عنوان';

    const p = document.createElement('p');
    p.className = "text-rich_black-600 text-base mb-4 line-clamp-3";
    const preview = stripHtml(article.ArticleText || '').slice(0, 150);
    p.textContent = preview ? preview + '…' : '';

    const span = document.createElement('span');
    span.className = "text-midnight_green-600 font-bold text-lg";
    span.textContent = 'مکمل مضمون پڑھیں ←';

    body.appendChild(h3);
    body.appendChild(p);
    body.appendChild(span);

    container.appendChild(img);
    container.appendChild(body);

    return container;
  }

  function render(list){
    if (!listEl) return;
    const arr = safeArray(list);
    if (!arr.length){
      listEl.innerHTML = '<p class="text-center text-air_force_blue">فی الحال کوئی مضمون دستیاب نہیں ہے۔</p>';
      return;
    }
    listEl.innerHTML = '';
    const frag = document.createDocumentFragment();
    arr.forEach(item => { frag.appendChild(createCard(item)); });
    listEl.appendChild(frag);
  }

  function applySearch(){
    if (!searchInput) { render(fullSet); return; }
    const q = (searchInput.value || '').trim().toLowerCase();
    if (!q) { render(fullSet); return; }
    const filtered = safeArray(fullSet).filter(a => {
      const title = String(a.Title || '').toLowerCase();
      const body  = stripHtml(a.ArticleText || '').toLowerCase();
      return title.includes(q) || body.includes(q);
    });
    render(filtered);
  }

  async function fetchArticles(newLimit){
    if (isLoading) return;
    isLoading = true;
    if (loader && safeArray(fullSet).length === 0) {
      loader.style.display = 'flex';
    } else if (inlineLoader) {
      inlineLoader.classList.remove('hidden');
    }

    try {
      const url = `${API_BASE.replace(/\/$/, '')}?limit=${encodeURIComponent(newLimit)}&offset=0`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Failed to load articles: ${res.status} ${res.statusText}`);
      const payload = await res.json();

      if (Array.isArray(payload)) {
        fullSet = payload;
      } else if (Array.isArray(payload.data)) {
        fullSet = payload.data;
      } else if (Array.isArray(payload.results)) {
        fullSet = payload.results;
      } else if (Array.isArray(payload.items)) {
        fullSet = payload.items;
      } else {
        fullSet = payload ? (typeof payload === 'object' ? [payload] : []) : [];
      }
      applySearch();
    } catch (err) {
      console.error('❌ Error loading articles:', err);
      if (listEl) listEl.innerHTML = '<p class="text-center text-air_force_blue">مضامین لوڈ کرنے میں مسئلہ آیا۔</p>';
    } finally {
      if (loader) loader.style.display = 'none';
      if (inlineLoader) inlineLoader.classList.add('hidden');
      isLoading = false;
    }
  }

  if (searchInput) searchInput.addEventListener('input', applySearch);

  if (limitDropdown) {
    limitDropdown.addEventListener('change', async () => {
      limit = Number(limitDropdown.value || '50');
      await fetchArticles(limit);
      const list = document.getElementById('articles-list');
      if (list) {
        const top = list.getBoundingClientRect().top + window.scrollY - 100;
        try { window.scrollTo({ top, behavior: 'smooth' }); }
        catch { window.scrollTo(0, top); }
      }
    });
  }

  (async function init(){
    if (limitDropdown) limitDropdown.value = String(limit);
    await fetchArticles(limit);
  })();
  </script>

</body>
</html>
